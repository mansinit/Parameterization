import json
import ast
import pandas as pd
import re
from openpyxl import load_workbook
f=open('TC2001_B2C_UC1_NCA_Succ.json')
excel_file="TC2001_B2C_UC1_NCA_Sarang_wo_param.xlsx"

file = pd.ExcelFile(excel_file,engine='openpyxl')
df=pd.DataFrame(pd.read_excel(file,sheet_name=file.sheet_names[0],engine='openpyxl'))
data=json.load(f)
#for i in data['serviceOrderItem']:
#    print(i)
data=(dict(data))

print(data.keys())


def json_extract(obj, key):
    """Recursively fetch values from nested JSON."""
    arr = []

    def extract(obj, arr, key):
        """Recursively search for values of key in JSON tree."""
        if isinstance(obj, dict):
            for k, v in obj.items():
                if isinstance(v, (dict, list)):
                    extract(v, arr, key)
                elif k == key:
                    arr.append(v)
        elif isinstance(obj, list):
            for item in obj:
                extract(item, arr, key)
        return arr

    values = extract(obj, arr, key)
    return values

list_names=((json_extract(data,'name')))
list_values=((json_extract(data,'value')))
dict_final={}
for x,y in zip(list_names,list_values):
    dict_final[x.upper()]=y
for key in data['relatedParty'][0].keys():
    dict_final[key.upper()]=((json_extract(data,key)))[0]
print(dict_final)
 


#load excel file
workbook = load_workbook(filename=excel_file)
 
#open workbook
sheet = workbook.active
 

for row in range(6,df.shape[0]):
    if sheet[row][8].value in dict_final.keys():
        if sheet[row][9].value==dict_final[sheet[row][8].value]:
            sheet[row][9].value="${"+sheet[row][8].value+"}"
    else:
        for txt in dict_final.keys():
            x= sheet[row][8].value.split("_")
            for l in range(0,len(x)):
                if x[l] in txt :
                    if (sheet[row][9].value)==dict_final[txt]:
                        sheet[row][9].value="${"+txt+"}"
 
#save the file
workbook.save(filename="output.xlsx")
